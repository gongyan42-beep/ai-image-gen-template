<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­£å¿ƒAI - æœè£…æ¿å—AIå›¾ç‰‡ç”Ÿæˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
        }

        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .upload-box {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .upload-box:hover {
            border-color: #764ba2;
            background: #f8f9ff;
        }

        .upload-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .upload-box p {
            color: #999;
            font-size: 14px;
        }

        .preview-image {
            max-width: 100%;
            max-height: 200px;
            margin-top: 15px;
            border-radius: 10px;
        }

        .config-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group select,
        .form-group input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .generate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 30px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result-section {
            text-align: center;
        }

        .result-image {
            max-width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error.show {
            display: block;
        }

        input[type="file"] {
            display: none;
        }

        #customSceneInput {
            display: none;
        }

        @media (max-width: 768px) {
            .upload-section {
                grid-template-columns: 1fr;
            }

            .config-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ æ­£å¿ƒAI</h1>
        <p class="subtitle">æœè£…æ¿å— AI å›¾ç‰‡ç”Ÿæˆ</p>

        <div class="error" id="errorMsg"></div>

        <div class="upload-section">
            <div class="upload-box" onclick="document.getElementById('garmentInput').click()">
                <h3>ğŸ“¸ æœè£…å›¾ç‰‡ *</h3>
                <p>ç‚¹å‡»ä¸Šä¼ æœè£…ç…§ç‰‡</p>
                <input type="file" id="garmentInput" accept="image/*" onchange="previewImage(this, 'garmentPreview')">
                <img id="garmentPreview" class="preview-image" style="display:none;">
            </div>

            <div class="upload-box" onclick="document.getElementById('referenceInput').click()">
                <h3>ğŸ–¼ï¸ å‚è€ƒå›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</h3>
                <p>ä¸Šä¼ å‚è€ƒå§¿åŠ¿/æ„å›¾çš„å›¾ç‰‡</p>
                <input type="file" id="referenceInput" accept="image/*" onchange="previewImage(this, 'referencePreview')">
                <img id="referencePreview" class="preview-image" style="display:none;">
            </div>
        </div>

        <div class="config-section">
            <div class="form-group">
                <label>æ¨¡ç‰¹ç§æ—</label>
                <select id="modelEthnicity">
                    <option value="Asian">äºšæ´²äºº</option>
                    <option value="Caucasian">ç™½ç§äºº</option>
                    <option value="African">éæ´²äºº</option>
                    <option value="Hispanic">æ‹‰ä¸è£”</option>
                    <option value="Mixed">æ··è¡€</option>
                </select>
            </div>

            <div class="form-group">
                <label>æ¨¡ç‰¹æ€§åˆ«</label>
                <select id="modelGender">
                    <option value="Female">å¥³æ€§</option>
                    <option value="Male">ç”·æ€§</option>
                    <option value="Non-binary">ä¸­æ€§</option>
                </select>
            </div>

            <div class="form-group">
                <label>å¹´é¾„èŒƒå›´</label>
                <select id="ageRange">
                    <option value="18-25">18-25å²</option>
                    <option value="20-30" selected>20-30å²</option>
                    <option value="30-40">30-40å²</option>
                    <option value="40-50">40-50å²</option>
                </select>
            </div>

            <div class="form-group">
                <label>åœºæ™¯èƒŒæ™¯</label>
                <select id="scene" onchange="toggleCustomScene()">
                    <option value="Studio with neutral background" selected>å·¥ä½œå®¤ä¸­æ€§èƒŒæ™¯</option>
                    <option value="Urban street">åŸå¸‚è¡—é“</option>
                    <option value="Beach sunset">æµ·æ»©æ—¥è½</option>
                    <option value="Luxury hotel lobby">å¥¢åé…’åº—å¤§å ‚</option>
                    <option value="Modern office">ç°ä»£åŠå…¬å®¤</option>
                    <option value="Garden park">èŠ±å›­å…¬å›­</option>
                    <option value="Shopping mall">è´­ç‰©ä¸­å¿ƒ</option>
                    <option value="Coffee shop">å’–å•¡å…</option>
                    <option value="Rooftop terrace">å±‹é¡¶éœ²å°</option>
                    <option value="Art gallery">è‰ºæœ¯ç”»å»Š</option>
                    <option value="custom">è‡ªå®šä¹‰åœºæ™¯...</option>
                </select>
            </div>

            <div class="form-group" id="customSceneGroup" style="display:none;">
                <label>è‡ªå®šä¹‰åœºæ™¯æè¿°</label>
                <input type="text" id="customSceneInput" placeholder="è¯·è¾“å…¥æ‚¨æƒ³è¦çš„åœºæ™¯ï¼Œå¦‚ï¼šæµ·è¾¹ã€æ£®æ—ç­‰">
            </div>

            <div class="form-group">
                <label>å…‰ç…§é£æ ¼</label>
                <select id="style">
                    <option value="Professional fashion photography lighting" selected>ä¸“ä¸šæ—¶å°šæ‘„å½±</option>
                    <option value="Natural daylight">è‡ªç„¶æ—¥å…‰</option>
                    <option value="Golden hour">é»„é‡‘æ—¶åˆ»</option>
                    <option value="Dramatic lighting">æˆå‰§æ€§å…‰ç…§</option>
                    <option value="Soft studio lighting">æŸ”å’Œå·¥ä½œå®¤å…‰</option>
                    <option value="Neon night lighting">éœ“è™¹å¤œæ™¯</option>
                    <option value="Vintage film lighting">å¤å¤èƒ¶ç‰‡</option>
                </select>
            </div>

            <div class="form-group">
                <label>å›¾ç‰‡æ¯”ä¾‹</label>
                <select id="aspectRatio">
                    <option value="1:1" selected>1:1 (æ­£æ–¹å½¢)</option>
                    <option value="3:4">3:4 (ç«–ç‰ˆ)</option>
                    <option value="4:3">4:3 (æ¨ªç‰ˆ)</option>
                    <option value="9:16">9:16 (æ‰‹æœºç«–ç‰ˆ)</option>
                    <option value="16:9">16:9 (å®½å±)</option>
                </select>
            </div>
        </div>

        <button class="generate-btn" onclick="generateImage()">âœ¨ ç”Ÿæˆå›¾ç‰‡</button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>AI æ­£åœ¨ç”Ÿæˆæ‚¨çš„æ—¶å°šç…§ç‰‡ï¼Œè¯·ç¨å€™...</p>
        </div>

        <div class="result-section" id="resultSection" style="display:none;">
            <h2 style="margin-bottom: 20px; color: #667eea;">ç”Ÿæˆç»“æœ</h2>
            <img id="resultImage" class="result-image">
            <div style="margin-top: 20px;">
                <button onclick="downloadImage()" style="padding: 12px 30px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                    â¬‡ï¸ ä¸‹è½½å›¾ç‰‡
                </button>
            </div>
        </div>
    </div>

    <script>
        function toggleCustomScene() {
            const sceneSelect = document.getElementById('scene');
            const customGroup = document.getElementById('customSceneGroup');
            const customInput = document.getElementById('customSceneInput');

            if (sceneSelect.value === 'custom') {
                customGroup.style.display = 'block';
                customInput.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
                customInput.style.display = 'none';
            }
        }

        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMsg');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 5000);
        }

        async function generateImage() {
            const garmentInput = document.getElementById('garmentInput');

            if (!garmentInput.files || !garmentInput.files[0]) {
                showError('è¯·å…ˆä¸Šä¼ æœè£…å›¾ç‰‡ï¼');
                return;
            }

            const formData = new FormData();
            formData.append('garment', garmentInput.files[0]);

            const referenceInput = document.getElementById('referenceInput');
            if (referenceInput.files && referenceInput.files[0]) {
                formData.append('reference', referenceInput.files[0]);
            }

            // å¤„ç†åœºæ™¯é€‰æ‹©
            let sceneValue = document.getElementById('scene').value;
            if (sceneValue === 'custom') {
                const customScene = document.getElementById('customSceneInput').value.trim();
                if (!customScene) {
                    showError('è¯·è¾“å…¥è‡ªå®šä¹‰åœºæ™¯æè¿°ï¼');
                    return;
                }
                sceneValue = customScene;
            }

            formData.append('modelEthnicity', document.getElementById('modelEthnicity').value);
            formData.append('modelGender', document.getElementById('modelGender').value);
            formData.append('ageRange', document.getElementById('ageRange').value);
            formData.append('scene', sceneValue);
            formData.append('style', document.getElementById('style').value);
            formData.append('aspectRatio', document.getElementById('aspectRatio').value);

            document.getElementById('loading').classList.add('show');
            document.getElementById('resultSection').style.display = 'none';

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('resultImage').src = data.image;
                    document.getElementById('resultSection').style.display = 'block';
                } else {
                    showError(data.message || data.error || 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥åé‡è¯•');
            } finally {
                document.getElementById('loading').classList.remove('show');
            }
        }

        function downloadImage() {
            const img = document.getElementById('resultImage');
            const link = document.createElement('a');
            link.href = img.src;
            link.download = 'fashion-ai-' + Date.now() + '.png';
            link.click();
        }
    </script>
</body>
</html>
